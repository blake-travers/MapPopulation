<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Leaflet Map with Attached Sidebar Toggle</title>

        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css"/>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>

        <style>
            html,body
            {
                height:100%;
                margin:0;
                overflow:hidden;
            }

            #container
            {
                position:relative;
                display:flex;
                height:100%;
                width:100%;
            }

            #map
            {
                flex:1 1 auto;
                height:100%;
                transition: width 0.2s ease;
                min-width: 0;
            }

            #sidebar
            {
                width: 30%;
                background:white;
                border-left:2px solid #ccc;
                height:100%;
                overflow:hidden;
                transition: width 0.2s ease, padding 0.2s ease;
                box-sizing:border-box;
                padding:0;
            }

            #sidebarButton
            {
                position: absolute;
                top: 50%;
                right: 30%;
                z-index: 3000;
                background: white;
                border:2px solid #ccc;
                border-right:4px solid white;


                padding: 8px 10px;
                cursor: pointer;
                border-radius: 4px;
                transition: right 0.21s ease;
                transform: translate(8%, -50%);
                display:flex;
                align-items:center;
                justify-content:center;
                width:42px;
                height:96px;
                font-size:16px;
                line-height:1;
            }

            .sidebar-inner
            {
                padding:15px;
                box-sizing:border-box;
            }

        </style>

    </head>

    <body>

        <button id="sidebarButton" aria-label="Toggle sidebar"></button>

        <div id="container">
            <div id="map"></div>

            <div id="sidebar" aria-hidden="true">
                <div class="sidebar-inner">
                    <h2>Population Tool</h2>
                    <p>Draw shapes on the map to estimate population.</p>
                        <div id="infoArea">No shapes yet.</div>
                </div>
            </div>
        </div>

        <script>
            // DOM references
            const sidebar = document.getElementById('sidebar');
            const mapDiv = document.getElementById('map');
            const toggleBtn = document.getElementById('sidebarButton');
            let sidebarOpen = false;
            toggleBtn.textContent = '▶';
            const SIDEBAR_WIDTH = '30%';
            

            // Initialize map
            const map = L.map('map').setView([-37.8136, 144.9631], 11);

            // Initialise layer/s
            var CartoDB_VoyagerNoLabels = L.tileLayer
            (
                'https://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}{r}.png',
                {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
                    subdomains: 'abcd',
                    maxZoom: 20
                }
            );

            var Esri_WorldGrayCanvas = L.tileLayer
            (
                'https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}',
                {
                    attribution: 'Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ',
                    maxZoom: 16
                }
            );


            var CartoDB_PositronOnlyLabels = L.tileLayer
            (
                'https://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}{r}.png',
                {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
                    subdomains: 'abcd',
                    maxZoom: 20
                }
            );

            Esri_WorldGrayCanvas.addTo(map)
            CartoDB_PositronOnlyLabels.addTo(map);


            // Folium-like Draw controls
            const drawnItems = new L.FeatureGroup();
            map.addLayer(drawnItems);

            const drawControl = new L.Control.Draw
            (
                {
                    edit:
                    {
                        featureGroup: drawnItems
                    },
                    draw:
                    {
                    polygon: true,  
                    rectangle: true,
                    circle: true,
                    polyline: false,
                    marker: false,
                    circlemarker: false
                    }
                }
            );
            map.addControl(drawControl);

            map.on(L.Draw.Event.CREATED, function (event)
            {
                const layer = event.layer;
                drawnItems.addLayer(layer);
                const geojson = layer.toGeoJSON();
                console.log("Exported GeoJSON:", geojson);
                alert("Shape drawn! GeoJSON logged to console.");
            });
            
            setInterval(() => {
                map.invalidateSize();
            }, 1);
            

            toggleBtn.addEventListener('click', () =>
            {
                sidebarOpen = !sidebarOpen;

                if (sidebarOpen) // If Sidebar is currently open:
                {
                    sidebar.style.width = SIDEBAR_WIDTH;
                    sidebar.setAttribute('aria-hidden', 'false');
                }
                else // If Sidebar is currently closed:
                {
                    sidebar.style.width = '0';
                    sidebar.setAttribute('aria-hidden', 'true');
                }

                toggleBtn.style.right = sidebarOpen ? SIDEBAR_WIDTH : '0';
                toggleBtn.textContent = sidebarOpen ? '▶' : '◀';

                //Reset map size when button is pressed
                const start = performance.now();

                const interval = setInterval(() => {
                    map.invalidateSize();

                    // Stop after 200 ms
                    if (performance.now() - start > 200) {
                        clearInterval(interval);
                    }
                }, 1);

            });


        </script>
    </body>
</html>
